<!DOCTYPE html>
<html>

<head>
    <title>Pr√°ctica 1</title>
    <meta charset="utf-8" />
    <link rel="stylesheet" href="css/nuevoAviso.css">
    <%- include("links") %>
    <link rel="stylesheet" href="css/avisos.css">
</head>

<body>

    <nav class="navbar navbar-expand-sm bg-dark">
        <div class="container-fluid">
            <div class="nav-brand">
                <img src="img/LogoUCM.png" alt="">
            </div>
            <div class="collapse navbar-collapse">
                <ul class="navbar-nav">
                    <li class="nav-item mt-auto mb-auto ms-2">
                        <button type="button" class="btn btn-dark" data-bs-toggle="modal" data-bs-target="#modalPerfil">
                            <%=nombre%>
                        </button> 
                    </li>
                </ul>
                <ul class="navbar-nav ms-auto">
                    <li class="nav-item">
                        <img class="rounded-circle me-4 ms-4 " src="imagen/<%=email%>" alt="">
                    </li>
                    <li class="nav-item mt-auto mb-auto">
                        <button type="button" class="btn btn-danger" onclick="window.location.href='/cerrarSesion'">Desconectar</button>
                    </li> 
                </ul>
            </div>
        </div>
    </nav>

    <div class="container">

        <div class="row mt-5">
            <div class="col">
                <div class="btn-group">
                    <a href="/avisos" class="btn btn-outline-primary">Mis Avisos</a>
                    <a href="/historicoAvisos" class="btn btn-outline-primary">Historico de avisos</a>
                </div>
            </div>
            <div class="col">
                <div class="d-flex">
                    <input class="form-control me-1" id="buscar" type="search" placeholder="Buscar" aria-label="Search">
                    <button class="btn btn-primary" type="submit">Buscar</button>
                </div>
            </div>
        </div>
        
    
            <table class="table table-striped table-hover mt-3">
                <thead class="table-dark">
                    <tr>
                        <th>Fecha</th>
                        <th>Texto</th>
                        <th>Tipo</th>
                        <th>Tecnico</th>
                    </tr>
                </thead>
                <tbody>
                    <% avisos.forEach(function(aviso){%>
                        <tr data-toggle="modal"data-bs-toggle="modal" data-bs-target="#verAviso">
                            <td> <%= aviso.fecha.toLocaleDateString("en-US") %> </td>
                            <td class="texto"> <%= aviso.texto.substr(0,200) %> </td>
                            <td> <img class="tipoLogo" src="/img/<%= aviso.tipo %>.png" alt=""></td>
                            <td> <%= aviso.idTecnico %> </td>
                        </tr>

                        <%- include("verAviso") %> 

                    <% }) %> 
                </tbody>
            </table>



            <div class="d-flex justify-content-end">
                <button class="btn btn-success" data-toggle="modal"data-bs-toggle="modal" data-bs-target="#exampleModal">Nuevo
                    aviso</button>
                <%- include("nuevoAviso")%>             
            </div>
    </div>

    <%- include("perfil") %>
    <%- include("scripts") %>
</body>



</html>

<script>

    $("#buscar").on("keyup", function(event){

        let texto = $("#buscar").prop("value").toUpperCase()
        let cols = $(".texto") //busca por campo nombre

        for (let i = 0; i < cols.length; i++){
            let t = cols.eq(i).text().toUpperCase() //Valor del campo texto
            if (t.indexOf(texto) < 0)
                cols.eq(i).parent().hide() //El padre de la columna es la fila entera. Se oculta
            else
                cols.eq(i).parent().show() //El padre de la columna es la fila entera. Se muestra
           
        }
        
    })

</script>
